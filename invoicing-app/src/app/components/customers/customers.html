<section class="page">
    <h1>Customers</h1>
    <div class="customer-btn-container">
        <app-new-customer (customerCreated)="onCustomerCreate()"></app-new-customer>
        <mat-slide-toggle style="position: relative; top: 5px;" [(ngModel)]="showInactiveCustomers">
            {{
            showInactiveCustomers ? "All Customers" : "Active Customers"
            }}</mat-slide-toggle>
    </div>
    <mat-form-field appearance="outline" class="filter-customer">
        <mat-label>Search</mat-label>
        <input matInput placeholder="Ex. Joe" [formControl]="filter">
    </mat-form-field>
    <div class="container mat-elevation-z8">
        @if (isLoadingResults || isRateLimitReached) {
        <div class="loading-shade">
            @if (isLoadingResults) {
            <mat-spinner></mat-spinner>
            }
            @if (isRateLimitReached) {
            <div class="rate-limit-reached">
                API rate limit has been reached. It will be reset in one minute.
            </div>
            }
        </div>
        }

        <div class="table-container">
            <table mat-table [dataSource]="customerData().items" class="example-table" matSort
                matSortActive="customerCode" matSortDisableClear matSortDirection="desc">
                <ng-container matColumnDef="customerCode">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Customer Code</th>
                    <td mat-cell *matCellDef="let row">{{row.customerCode}}</td>
                </ng-container>
                <ng-container matColumnDef="firstName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>First Name</th>
                    <td mat-cell *matCellDef="let row">{{row.firstName}}</td>
                </ng-container>
                <ng-container matColumnDef="lastName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Name</th>
                    <td mat-cell *matCellDef="let row">{{row.lastName}}</td>
                </ng-container>
                <ng-container matColumnDef="company">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Company</th>
                    <td mat-cell *matCellDef="let row">{{row.company}}</td>
                </ng-container>
                <ng-container matColumnDef="email">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
                    <td mat-cell *matCellDef="let row">{{row.email}}</td>
                </ng-container>
                <ng-container matColumnDef="activeStatus">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Active Status</th>
                    <td mat-cell *matCellDef="let row">
                        <mat-icon [style]="`color:${row.activeStatus ? 'green': 'red'}`">
                            {{row.activeStatus ? 'check_circle' : 'cancel'}}
                        </mat-icon>
                    </td>
                </ng-container>


                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr class="customer-row" mat-row *matRowDef="let row; columns: displayedColumns;"
                    (click)="onCustomerRowClick(row)"></tr>
            </table>
        </div>

        <mat-paginator [length]="customerData().total_count" [pageSize]="30"
            aria-label="Select page of GitHub search results"></mat-paginator>
    </div>
</section>